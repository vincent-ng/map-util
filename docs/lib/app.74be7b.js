!function(t){function e(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n=window.webpackJsonp;window.webpackJsonp=function(r,o,a){for(var s,c,u,d=0,l=[];d<r.length;d++)c=r[d],i[c]&&l.push(i[c][0]),i[c]=0;for(s in o)Object.prototype.hasOwnProperty.call(o,s)&&(t[s]=o[s]);for(n&&n(r,o,a);l.length;)l.shift()();if(a)for(d=0;d<a.length;d++)u=e(e.s=a[d]);return u};var r={},i={1:0};e.e=function(t){function n(){s.onerror=s.onload=null,clearTimeout(c);var e=i[t];0!==e&&(e&&e[1](new Error("Loading chunk "+t+" failed.")),i[t]=void 0)}var r=i[t];if(0===r)return new Promise(function(t){t()});if(r)return r[2];var o=new Promise(function(e,n){r=i[t]=[e,n]});r[2]=o;var a=document.getElementsByTagName("head")[0],s=document.createElement("script");s.type="text/javascript",s.charset="utf-8",s.async=!0,s.timeout=12e4,e.nc&&s.setAttribute("nonce",e.nc),s.src=e.p+"lib/"+t+"."+{0:"48c89c"}[t]+".js";var c=setTimeout(n,12e4);return s.onerror=s.onload=n,a.appendChild(s),o},e.m=t,e.c=r,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e.oe=function(t){throw console.error(t),t}}({472:function(t,e,n){"use strict";n(473),n(474),t.exports={"webpack-index-template":{id:"webpack-index-template"},"map-util-portal":{id:"map-util-portal"}}},473:function(t,e,n){"use strict"},474:function(t,e,n){"use strict";function r(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function i(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){function r(i,o){try{var a=e[i](o),s=a.value}catch(t){return void n(t)}if(!a.done)return Promise.resolve(s).then(function(t){r("next",t)},function(t){r("throw",t)});t(s)}return r("next")})}}var o=n(95),a=n(96);n(477),n(490),n(491),n(492);var s=n(493),c=n(97),u=n(496),d=n(512);a(i(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a("title").html("Map Util"),e=a("#brickyard-app"),e.html(s),t.next=5,d.init("mapComponent");case 5:c.init("loaderComponent"),u.init("fileComponent"),u.onRead=function(t){var e=o.concat.apply(o,r(o.values(t)));d.resetSidebar(),d.setRenderList(e),a("#getGeoLocations").off("click").click(i(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.fetchGeoLocations();case 2:a("#infoComponent span").html(", passed "+d.passedDistrict.length+" districts."),a("#passedDistrict").text("passed districts: "+d.passedDistrict);case 4:case"end":return t.stop()}},t,void 0)}))),a("#quickGetGeoLocations").off("click").click(i(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.quickFetchGeoLocations();case 2:a("#infoComponent span").html(", passed "+d.passedDistrict.length+" districts."),a("#passedDistrict").text("passed districts: "+d.passedDistrict);case 4:case"end":return t.stop()}},t,void 0)}))),a("#exportFile").off("click").click(function(){u.exportFile(d.renderList,"locations"+Date.now())}),a("#operations").show(),a("#infoComponent").html("<p>total distance: "+(d.totalDistance/1e3).toFixed(2)+" km, active time: "+d.activeHours+" hours<span>"+(d.passedDistrict.length?", passed "+d.passedDistrict.length+" districts.":"")+"</span></p><p id='passedDistrict'>"+(d.passedDistrict.length?"passed districts: "+d.passedDistrict:"")+"</p>").show()};case 8:case"end":return t.stop()}},t,void 0)})))},492:function(t,e){},494:function(t,e){},496:function(t,e,n){"use strict";function r(t){var e=new u(t,{readAs:"BinaryString"});e.onRead("start",function(){return c.showSpinner()}),e.onRead("end",function(){return c.hideSpinner()}),e.onRead("file",function(t){var e=t.data,n=s.read(e,{type:"binary",cellText:!1,cellDates:!0}),r={};n.SheetNames.forEach(function(t){var e=s.utils.sheet_to_row_object_array(n.Sheets[t],{dateNF:"YYYY-MM-DD HH:mm:ss"});e.length>0&&(r[t]=e)}),d.onRead(r)})}function i(t){var e=void 0,n=void 0;"undefined"!=typeof ArrayBuffer?(e=new ArrayBuffer(t.length),n=new Uint8Array(e)):(e=new Array(t.length),n=e);for(var r=0;r!==t.length;r+=1)n[r]=255&t.charCodeAt(r);return e}function o(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"xlsx",r=s.utils.book_new(),o=s.utils.json_to_sheet(t);s.utils.book_append_sheet(r,o,"sheet");var c=s.write(r,{bookType:n,bookSST:!0,type:"binary"});a.saveAs(new Blob([i(c)],{type:"application/octet-stream"}),e+"."+n)}var a=n(497),s=n(500),c=n(97),u=n(509),d={};d.onRead=function(){throw new Error("onRead handler not set")},d.init=r,d.exportFile=o,t.exports=d},512:function(t,e,n){"use strict";function r(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){function r(i,o){try{var a=e[i](o),s=a.value}catch(t){return void n(t)}if(!a.done)return Promise.resolve(s).then(function(t){r("next",t)},function(t){r("throw",t)});t(s)}return r("next")})}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function a(t){var e=Number(t);return e>=-180&&e<=180?e:e/36e5}function s(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i=!0,o=!1,a=void 0;try{for(var s,c=f.keys(t)[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;if(n.includes(u.toLowerCase()))return t[u]}}catch(t){o=!0,a=t}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}return null}function c(t){if(!t)return null;var e=a(s(t,"clng","clon","clongitude","偏转经度")),n=a(s(t,"clat","clatitude","偏转纬度"));if(e&&n)return new BMap.Point(e,n);var r=a(s(t,"lng","lon","longitude","经度")),i=a(s(t,"lat","latitude","纬度"));if(r&&i){var c=y.wgs84togcj02(r,i);return c=y.gcj02tobd09(c[0],c[1]),new(Function.prototype.bind.apply(BMap.Point,[null].concat(o(c))))}return null}function u(t){document.getElementById("sidebar").innerHTML=m({data:t})}function d(t){return t*Math.PI/180}function l(t,e){var n=t.lng-e.lng,r=t.lat-e.lat,i=(t.lat+e.lat)/2,o=6367e3*d(n)*Math.cos(d(i)),a=6367e3*d(r);return Math.pow(Math.pow(o,2)+Math.pow(a,2),.5)}var p=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n(513);var f=n(95),h=n(0),v=n(515),m=f.template(n(516)),g=n(517),y=n(518),P=n(97),w=function(){function t(){i(this,t),this.mapInst=void 0,this.renderList=[],this.renderPoints=[],this.lastClickSidebarPointIndex=void 0,this.totalDistance=0,this.activeHours=0,this.passedDistrict=[]}return p(t,[{key:"init",value:function(){function t(t){return e.apply(this,arguments)}var e=r(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=document.getElementById(e),n.innerHTML=v,t.next=4,g.init("map");case 4:this.mapInst=t.sent;case 5:case"end":return t.stop()}},t,this)}));return t}()},{key:"setRenderList",value:function(t){var e=this;this.renderList=t,this.renderPoints=t.map(function(t,e){var n=c(t);return n&&(n.index=e),n}),this.totalDistance=this.renderPoints.map(function(t,n){return n?l(e.renderPoints[n-1],t):0}).reduce(function(t,e){return t+e},0);var n=f.groupBy(t,"district");delete n.undefined,this.passedDistrict=f.keys(n);var r=t.filter(function(t){return"1"===t.category}).map(function(t){var e=h(t.timestamp);return t.active_hour=e.format("YYYY-MM-DD HH"),t});this.activeHours=f.keys(f.groupBy(r,"active_hour")).length;var i={size:BMAP_POINT_SIZE_SMALL,shape:BMAP_POINT_SHAPE_CIRCLE,color:"#d340c3"},o=new BMap.PointCollection(this.renderPoints,i);o.addEventListener("click",function(t){e.lastClickSidebarPointIndex=t.point.index,u(e.renderList[t.point.index])}),this.mapInst.addOverlay(o),this.mapInst.setViewport(this.renderPoints,{zoomFactor:-1,delay:200})}},{key:"resetSidebar",value:function(){this.lastClickSidebarPointIndex=void 0,u({"":"Select marker to view info"})}},{key:"fetchGeoLocations",value:function(){function t(){return e.apply(this,arguments)}var e=r(regeneratorRuntime.mark(function t(){var e,n,r,i,o,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:P.showProgressBar(),P.setProgress(0),e=f.debounce(P.setProgress,250,{trailing:!0,maxWait:250}),n=0;case 4:if(!(n<this.renderPoints.length)){t.next=16;break}return r=this.renderPoints[n],t.next=8,this.mapInst.getGeoLocation(r);case 8:i=t.sent,e(Math.ceil(n/this.renderPoints.length*100)),o=this.renderList[r.index],Object.assign(o,i),this.lastClickSidebarPointIndex===r.index&&u(o);case 13:n+=1,t.next=4;break;case 16:e(100),P.hideProgressBar(),a=f.groupBy(this.renderList,"district"),this.passedDistrict=f.keys(a);case 20:case"end":return t.stop()}},t,this)}));return t}()},{key:"quickFetchGeoLocations",value:function(){function t(){return e.apply(this,arguments)}var e=r(regeneratorRuntime.mark(function t(){var e,n,r,i,o,a,s,c,d;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return P.showProgressBar(),P.setProgress(0),e=f.debounce(P.setProgress,250,{trailing:!0,maxWait:250}),n=f.cloneDeep(this.renderPoints[0]),t.next=6,this.mapInst.getGeoLocation(n);case 6:r=t.sent,i=[Object.assign(n,r)],o=0;case 9:if(!(o<this.renderPoints.length)){t.next=23;break}if(a=f.cloneDeep(this.renderPoints[o]),!(l(i[i.length-1],a)>1e3)){t.next=19;break}return t.next=14,this.mapInst.getGeoLocation(a);case 14:s=t.sent,i.push(Object.assign(a,s)),c=this.renderList[a.index],Object.assign(c,s),this.lastClickSidebarPointIndex===a.index&&u(c);case 19:e(Math.ceil(o/this.renderPoints.length*100));case 20:o+=1,t.next=9;break;case 23:e(100),P.hideProgressBar(),d=f.groupBy(i,"district"),this.passedDistrict=f.keys(d);case 27:case"end":return t.stop()}},t,this)}));return t}()}]),t}();t.exports=new w},513:function(t,e){},517:function(t,e,n){"use strict";function r(t){return t*(Math.PI/180)}function i(t){return t*(180/Math.PI)}function o(t,e,n,o){var a=r(t),s=r(e),c=r(n),u=r(o),d=u-s,l=Math.log(Math.tan(c/2+Math.PI/4)/Math.tan(a/2+Math.PI/4));return Math.abs(d)>Math.PI&&(d=d>0?-2*Math.PI+d:2*Math.PI+d),(i(Math.atan2(d,l))+360)%360}function a(t,e){var n=["北","东北","东","东南","南","西南","西","西北","北"],r=o(t.lat,t.lng,e.lat,e.lng);return n[Math.round(r/45)]||"附近"}function s(t,e){var n=e.address;if(e.surroundingPois.length>0){d.forEach(e.surroundingPois,function(e){e.distance=BMap.Map.prototype.getDistance(t,e.point)}),e.surroundingPois.sort(function(t,e){return t.distance-e.distance});var r=e.surroundingPois[0];n+="，"+r.title,n+=a(r.point,t),r.distance<1?n+="小于1米":n+=r.distance.toFixed(0)+"米"}return n}function c(t){var e=this;return new Promise(function(n){e.geo.getLocation(t,function(e){var r=d.pick(e.addressComponents,"province","city","district","street","streetNumber");r.address=s(t,e),n(r)})})}function u(t){var e=new BMap.Map(t,{enableHighResolution:!0,minZoom:5});e.centerAndZoom(new BMap.Point(116.404,39.915),11),e.enableScrollWheelZoom(!0),e.enableInertialDragging(),e.enableContinuousZoom();var n=new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_LEFT,type:BMAP_NAVIGATION_CONTROL_LARGE}),r=new BMap.ScaleControl({anchor:BMAP_ANCHOR_BOTTOM_LEFT}),i=new BMap.MapTypeControl({type:BMAP_MAPTYPE_CONTROL_HORIZONTAL,mapTypes:[BMAP_NORMAL_MAP,BMAP_SATELLITE_MAP,BMAP_PERSPECTIVE_MAP,BMAP_HYBRID_MAP]});return i.setOffset(new BMap.Size(15,10)),e.addControl(n),e.addControl(r),e.addControl(i),e.geo=new BMap.Geocoder,e.getGeoLocation=c,e}var d=n(95),l=n(96);t.exports.init=function(t){return new Promise(function(e){"https:"===document.location.protocol&&(window.HOST_TYPE="2");var n="//api.map.baidu.com/getscript?v=2.0&ak=IP0OO8wiWGlANXqlEoDOqwHW&services=&t="+Date.now();l.getScript(n,function(){return e(u(t))})})}},97:function(t,e,n){"use strict";function r(){document.getElementById("spinner").removeAttribute("hidden")}function i(){document.getElementById("spinner").setAttribute("hidden","")}function o(){document.getElementById("progress").removeAttribute("hidden")}function a(){document.getElementById("progress").setAttribute("hidden","")}function s(t){var e=document.getElementById("progress-bar");e.setAttribute("style","width: "+t+"%;"),e.innerHTML=t+"%"}function c(t){document.getElementById(t).innerHTML=u}n(494);var u=n(495);t.exports={showSpinner:r,hideSpinner:i,showProgressBar:o,hideProgressBar:a,setProgress:s,init:c}}});